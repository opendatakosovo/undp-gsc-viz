{% extends "base.html" %}
{% block body %}

<!-- Chart scripts -->
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/highcharts-more.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>

<script>
  $(document).ready(function() {
    // Handler for .ready() called.
    drawSpiderweb();

    $('#spiderweb-group-select').change(function() {
      // Every we select a new group, let's redraw the chart.
      drawSpiderweb();
    });

  });

  /**
   * Draw the bubble chart.
   **/
  function drawBubbleChart(){

  }

  /**
   * Draw the spiderweb chart.
   **/
  function drawSpiderweb(){

    group = $('#spiderweb-group-select').val();
    jsonUrl = '/json/question/' + {{qid}} + '/group/' + group;
    var id = {{qid}};
    var qKey = "q" + id;

    $.get(jsonUrl, function(jsonResult){

        // TODO: Look at the Console in the browser to see what jsonResult looks like
        //console.log(jsonResult);

        // TODO: build categories array base on jsonResult. Look at javascript functions you can use in utils.js
	    var categories = [];

        for(var i = 0; i < jsonResult['count']['answers']; i++){
            var aKey = "a" + (i + 1);
		    categories[i] = i + 1;
		}
		console.log(categories);
        // TODO: build series array based on jsonResult.

        // TODO: build series array based on jsonResult.
        var series = [];

        // For each group...
        for (var g = 0; g < jsonResult['count']['group']; g++){
            var group = jsonResult['answers'][g];
            var data = [];

            // Get the value for each answer
            for(var i = 0; i < jsonResult['count']['answers']; i++){
                // Build the data array
                var aKey = 'a' + (i + 1);
                data[i] = group[aKey];
            }

            var seriesItem = {
                name: group['_id'], // Get the name of the group
                data: data,
                pointPlacement: 'on'
            }

            series[g] = seriesItem;
        }

        $('#spiderweb').highcharts({
          chart: {
              polar: true,
              type: 'line'
          },

          title: {
              text: '',
              x: -80
          },

          pane: {
              size: '80%'
          },

          xAxis: {
              categories: categories,
              tickmarkPlacement: 'on',
              lineWidth: 0
          },

          yAxis: {
              gridLineInterpolation: 'polygon',
              lineWidth: 0,
              min: 0
          },

          tooltip: {
              shared: true,
              pointFormat: '<span style="color:{series.color}">{series.name}: <b>{point.y:,.0f}</b><br/>'
          },

          legend: {
              align: 'right',
              verticalAlign: 'top',
              y: 70,
              layout: 'vertical'
          },

          series: series

      });

    });


  }

  /**
   * Draw the windrose chart.
   **/
  function drawWindrose(){

  }
</script>


  <div id="bubblechart">
    Bubble Chart goes here.
  </div>

  <br><br>

  <div id="spiderweb-container">

    <div id="spiderweb" style="min-width: 400px; max-width: 600px; height: 400px; margin: 0 auto"></div> 

    <br>

    <div>
      <form class="form-horizontal" role="form">
          <div class="form-group">
            <label class="control-label col-sm-2" for="spiderweb-group-select">Group by</label>
            <div class="col-sm-2">
              <select id="spiderweb-group-select" class="form-control">
                <option value="gender" selected>Gender</option>
                <option value="education">Education</option>
                <option value="municipality">Municipality</option>
              </select>
            </div>
          </div>
      </form>
    </div>

    <div>
      
    </div>

  </div>

  <br><br>

  <div id="windrose">
    Windrose goes here.
  </div>



</table>

{% endblock %}